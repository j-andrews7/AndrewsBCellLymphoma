<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyzing RNA-seq data • OneLinerOmics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing RNA-seq data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OneLinerOmics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/RNAseqAnalysis.html">Analyzing RNA-seq data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/j-andrews7/OneLinerOmics">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Analyzing RNA-seq data</h1>
                        <h4 class="author">Jared Andrews</h4>
            <address class="author_afil">
      Washington University School of Medicine, Department of Laboratory and Genomic Medicine<br><a class="author_email" href="mailto:#"></a><a href="mailto:jared.andrews07@gmail.com" class="email">jared.andrews07@gmail.com</a>
      </address>
                  
            <h4 class="date">Revised: Ocotober 24th, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/j-andrews7/OneLinerOmics/blob/master/vignettes/RNAseqAnalysis.Rmd"><code>vignettes/RNAseqAnalysis.Rmd</code></a></small>
      <div class="hidden name"><code>RNAseqAnalysis.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette walks through analysis of the B cell lymphoma RNA-seq data included in the future Andrews et al. (2019, your favorite journal with an impact factor &gt; 30) paper. It uses the convenience functions included in this <a href="https://github.com/j-andrews7/OneLinerOmics">package</a> to streamline the process.</p>
<p>Several command line tools as well as python are also utilized - each code block should indicate whether it is <code>bash</code>, <code>R</code>, or <code>python</code> code. If your system is set up properly, you can still <a href="https://bookdown.org/yihui/rmarkdown/language-engines.html">run many of these code chunks in Rmarkdown files within RStudio</a>, assuming you have all of the software installed.</p>
<p>Some of this code is best ran on a computing cluster, as it takes a significant amount of time locally. Such instances will have <code>- cluster</code> appended to the language statement at the beginning of the code block.</p>
<p>Required Software:</p>
<ul>
<li>R (3.6+)</li>
<li>python3</li>
<li><a href="https://combine-lab.github.io/salmon/">salmon (v0.14+)</a></li>
<li>
<a href="https://bedtools.readthedocs.io/en/latest/">bedtools</a> - only needed if generating salmon decoy transcriptome</li>
<li>
<a href="https://github.com/marbl/MashMap">mashmap</a> - only needed if generating salmon decoy transcriptome</li>
<li>
<a href="https://github.com/alexdobin/STAR">STAR</a> - only needed if generating tracks</li>
<li>
<a href="https://deeptools.readthedocs.io/en/latest/index.html">deeptools</a> - only needed if generating tracks</li>
</ul>
</div>
<div id="faqssuggested-reading" class="section level1">
<h1 class="hasAnchor">
<a href="#faqssuggested-reading" class="anchor"></a>FAQs/Suggested Reading</h1>
<p>That is, if you ask me one of the following questions and haven’t read/tried these first, I’m going to tell you to read/try them.</p>
<ul>
<li>“How do I tweak (x) part of the analysis?”
<ul>
<li>Read the <a href="http://master.bioconductor.org/packages/release/workflows/vignettes/rnaseqGene/inst/doc/rnaseqGene.html">rnaseqGene</a> workflow, which walks through a DESeq2 analysis in great detail.</li>
<li>Read the <a href="https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#standard-workflow">DESeq2 vignette</a>.</li>
</ul>
</li>
<li>“How does the design formula work?”
<ul>
<li>Read <a href="https://cran.r-project.org/doc/manuals/R-intro.html#Statistical-models-in-R">this chapter</a> on statistical models in R, which explains linear models and formulae relatively clearly.</li>
</ul>
</li>
</ul>
<div id="generating-gene-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-gene-counts" class="anchor"></a>Generating gene counts</h2>
<p>This requires R, salmon v0.14, and DESeq2 (along with a few other packages). I’m using hg19, but you can supply newer annotations if you want. <code>salmon</code> needs <code>mashmap</code> and <code>bedtools</code> as well if generating “decoy-aware” transcriptomes.</p>
<div id="create-decoy-reference-transcriptome" class="section level3">
<h3 class="hasAnchor">
<a href="#create-decoy-reference-transcriptome" class="anchor"></a>Create decoy reference transcriptome</h3>
<p>Newer versions of salmon recommend using a <em>decoy-aware</em> transcriptome to generate the index file to be used for selective alignment. This process is a bit annoying, so the authors have pre-computed some <a href="https://drive.google.com/drive/folders/14VqSdZAKH82QwDWhMXNLFqMoskoqv3fS">decoy transcriptomes</a> for hg19 and hg38 with different annotations. In this case, I used the <a href="ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_31/GRCh37_mapping/">GENCODE v31 annotations</a> that had been lifted over to hg19, so I had to generate them myself.</p>
<blockquote>
<p><strong>This had to be run on a cluster with 128 GB RAM. If you can avoid this step by using their pre-generated decoys, I recommend doing so.</strong></p>
</blockquote>
<p>My data is already in folders and all, so some of the paths are kinda inefficient, but I really don’t care. This is needed to create the index for <code>salmon</code>. Using GENCODE v31 annotations/sequences that have been mapped back to GRCh37 (hg19).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># bash</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">mkdir</span> -p RNA_seq/ref</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># annotations</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="fu">wget</span> ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_31/GRCh37_mapping/gencode.v31lift37.annotation.gtf.gz</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="fu">mv</span> gencode.v31lift37.annotation.gtf.gz ./RNA_Seq/ref/gencode.v31lift37.annotation.gtf.gz</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="fu">gunzip</span> ./RNA_seq/ref/gencode.v31lift37.annotation.gtf.gz</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co"># transcriptome</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="fu">wget</span> ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_31/GRCh37_mapping/gencode.v31lift37.transcripts.fa.gz</a>
<a class="sourceLine" id="cb1-11" title="11"><span class="fu">mv</span> gencode.v31lift37.transcripts.fa.gz ./RNA_Seq/ref/gencode.v31lift37.transcripts.fa.gz</a>
<a class="sourceLine" id="cb1-12" title="12"><span class="fu">gunzip</span> ./RNA_seq/ref/gencode.v31lift37.transcripts.fa.gz</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># genome</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="fu">wget</span> ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_31/GRCh37_mapping/GRCh37.primary_assembly.genome.fa.gz</a>
<a class="sourceLine" id="cb1-16" title="16"><span class="fu">mv</span> GRCh37.primary_assembly.genome.fa.gz ./RNA_Seq/ref/GRCh37.primary_assembly.genome.fa.gz</a>
<a class="sourceLine" id="cb1-17" title="17"><span class="fu">gunzip</span> ./RNA_seq/ref/GRCh37.primary_assembly.genome.fa.gz</a></code></pre></div>
<p>Download the script to generate the decoys.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># bash</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># Script for generating decoy genome.</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="fu">wget</span> https://raw.githubusercontent.com/COMBINE-lab/SalmonTools/master/scripts/generateDecoyTranscriptome.sh</a></code></pre></div>
<p>This script crashed a lot for me, so I ended up editing it to just snag the last 10 commands or so (those with the step comments) and removing the variable parsing at the beginning, as it uses some deprecated linux commands (<code>readpath</code>) that I couldn’t install on our computing cluster.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># bash</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="fu">bash</span> generateDecoyTranscriptome.sh -j 2 -a ./RNA_Seq/ref/gencode.v31lift37.annotation.gtf \</a>
<a class="sourceLine" id="cb3-3" title="3">-g ./RNA_Seq/ref/GRCh37.primary_assembly.genome.fa -t ./RNA_Seq/ref/gencode.v31lift37.transcripts.fa \</a>
<a class="sourceLine" id="cb3-4" title="4">-o ./RNA_Seq/ref/decoys/</a></code></pre></div>
</div>
<div id="index-the-transcriptome" class="section level3">
<h3 class="hasAnchor">
<a href="#index-the-transcriptome" class="anchor"></a>Index the transcriptome</h3>
<p>This will generate the <em>decoy-aware</em> transcriptome index for our annotations.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Bash</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co"># Now actually create the index for salmon. We lower k as some of our samples use 50 bp reads.</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="ex">salmon</span> index -t ./RNA_Seq/ref/decoys/gentrome.fa -i ./RNA_Seq/ref/gencodev31_grch37_index \</a>
<a class="sourceLine" id="cb4-4" title="4">--decoys ./RNA_Seq/ref/decoys/decoys.txt -k 25 --gencode</a></code></pre></div>
</div>
<div id="quantify" class="section level3">
<h3 class="hasAnchor">
<a href="#quantify" class="anchor"></a>Quantify</h3>
<p>Actually generate the gene counts now.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># bash</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/Control.html">for</a></span> <span class="ex">f</span> in ./RNA_Seq/FASTQs/*<span class="kw">;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="va">samp=</span><span class="st">"</span><span class="va">${f##</span>*/<span class="va">}</span><span class="st">"</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="va">count=$(</span><span class="fu">ls</span> -1 <span class="st">"</span><span class="va">$f</span><span class="st">"</span> <span class="kw"><a href="https://rdrr.io/r/base/Logic.html">|</a></span> <span class="fu">wc</span> -l<span class="va">)</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="bu">echo</span> <span class="st">"</span><span class="va">$count</span><span class="st">"</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="kw"><a href="https://rdrr.io/r/base/Control.html">if</a></span><span class="bu"> [</span> <span class="va">$count</span> <span class="ot">-gt</span> 1<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="kw">then</span></a>
<a class="sourceLine" id="cb5-8" title="8">        <span class="ex">salmon</span> quant --validateMappings --threads 2 --seqBias -l A -1 <span class="st">"</span><span class="va">$f</span><span class="st">"</span>/<span class="st">"</span><span class="va">$samp</span><span class="st">"</span>_1.fq.gz \</a>
<a class="sourceLine" id="cb5-9" title="9">        -2 <span class="st">"</span><span class="va">$f</span><span class="st">"</span>/<span class="st">"</span><span class="va">$samp</span><span class="st">"</span>_2.fq.gz -o ./RNA_Seq/quants/<span class="st">"</span><span class="va">$samp</span><span class="st">"</span> --index ./RNA_Seq/ref/gencodev31_grch37_index</a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="kw"><a href="https://rdrr.io/r/base/Control.html">else</a></span></a>
<a class="sourceLine" id="cb5-11" title="11">        <span class="ex">salmon</span> quant --validateMappings --threads 2 --seqBias -l A -r <span class="st">"</span><span class="va">$f</span><span class="st">"</span>/<span class="st">"</span><span class="va">$samp</span><span class="st">"</span>.RNA.fq.gz \</a>
<a class="sourceLine" id="cb5-12" title="12">        -o ./RNA_Seq/quants/<span class="st">"</span><span class="va">$samp</span><span class="st">"</span> --index ./RNA_Seq/ref/gencodev31_grch37_index</a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="kw">fi</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="kw">done</span></a></code></pre></div>
</div>
<div id="make-transcript-to-gene-mappings" class="section level3">
<h3 class="hasAnchor">
<a href="#make-transcript-to-gene-mappings" class="anchor"></a>Make Transcript-to-Gene Mappings</h3>
<p>For gene-level summarization and readability.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># python</span></a>
<a class="sourceLine" id="cb6-2" title="2">outter <span class="op">=</span> <span class="bu">open</span>(<span class="st">"./RNA_Seq/ref/tx2gene.txt"</span>, <span class="st">"w"</span>)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"./RNA_Seq/ref/gencode.v31lift37.transcripts.fa"</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="cf">for</span> line <span class="kw"><a href="https://rdrr.io/r/base/Control.html">in</a></span> f:</a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="cf">if</span> <span class="kw">not</span> line.startswith(<span class="st">"&gt;"</span>):</a>
<a class="sourceLine" id="cb6-6" title="6">            <span class="cf">continue</span></a>
<a class="sourceLine" id="cb6-7" title="7">        line <span class="op">=</span> line.strip().strip(<span class="st">"&gt;"</span>).split(<span class="st">"|"</span>)</a>
<a class="sourceLine" id="cb6-8" title="8">        tx <span class="op">=</span> line[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb6-9" title="9">        symb <span class="op">=</span> line[<span class="dv">5</span>]</a>
<a class="sourceLine" id="cb6-10" title="10">        out <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>.join([tx, symb])</a>
<a class="sourceLine" id="cb6-11" title="11">        <span class="bu">print</span>(out, <span class="bu">file</span> <span class="op">=</span> outter)</a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13">outter.close()</a></code></pre></div>
</div>
</div>
<div id="analysis-with-r" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-with-r" class="anchor"></a>Analysis with R</h2>
<p>Install this package if you haven’t already with <code><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">devtools::install_github("j-andrews7/OneLinerOmics")</a></code>. If you don’t have <code>devtools</code>, it can be installed with <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("devtools")</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># R</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(OneLinerOmics))</a></code></pre></div>
<p>The only thing you need now is a sample sheet, which is just a table with sample names and metadata columns. We can take a peek at the sample sheet I’m using so he can see how they’re constructed. It can include as many metadata columns as you’d like.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># R</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co"># Basic sample sheet.</span></a>
<a class="sourceLine" id="cb8-3" title="3">samples &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="st">"./RNA_Seq/Samples.allCLL.txt"</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(samples, <span class="dv">10</span>)</a></code></pre></div>
<div id="run-deseq2" class="section level3">
<h3 class="hasAnchor">
<a href="#run-deseq2" class="anchor"></a>Run DESeq2</h3>
<p>DESeq2 is a very popular R package for performing differential expression analysis. Raw RNA-seq counts follow a negative binomial distribution, which is how DESeq2 models the data. It is quick, flexible, and generally works quite well with little to no parameter tweaking. It can also help to mitigate the technical or batch effects on the analysis, a feature which we’ll take advantage of here.</p>
<p>Most of these samples are 150 bp, paired-end sequencing (as shown in the ‘lib’ column of the sample sheet). A handful are 50 bp, single-end sequencing, which introduces a significant confounding factor to the analysis. In our model design, we’ll specify that we want to ignore effects due to this technical difference (by setting <code>block = "lib"</code>). The model isn’t magic, so we may very well still see evidence of the library-prep differences regardless, as they are quite strong.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># R</span></a>
<a class="sourceLine" id="cb9-2" title="2">mydata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/RunDESeq2.html">RunDESeq2</a></span>(<span class="dt">outpath =</span> <span class="st">"./RNA_Seq/Final_Analyses/allCLL"</span>, <span class="dt">quants.path =</span> <span class="st">"./RNA_Seq/quants"</span>, </a>
<a class="sourceLine" id="cb9-3" title="3">          <span class="dt">samplesheet =</span> <span class="st">"./RNA_Seq/Samples.allCLL.txt"</span>, <span class="dt">tx2gene =</span> <span class="st">"./RNA_Seq/ref/tx2gene.txt"</span>,</a>
<a class="sourceLine" id="cb9-4" title="4">          <span class="dt">level =</span> <span class="st">"disease"</span>, <span class="dt">block =</span> <span class="st">"lib"</span>, <span class="dt">padj.thresh =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>), </a>
<a class="sourceLine" id="cb9-5" title="5">          <span class="dt">plot.annos =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"disease"</span>, <span class="st">"disease.sub"</span>), <span class="dt">count.filt =</span> <span class="dv">50</span>)</a></code></pre></div>
</div>
<div id="next-steps" class="section level3">
<h3 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next Steps</h3>
<p>Yes, that’s it. Explore the plots, tables, enrichments, etc. Re-run if necessary, tweaking parameters as you see fit.</p>
</div>
</div>
<div id="alignment-creating-tracks" class="section level2">
<h2 class="hasAnchor">
<a href="#alignment-creating-tracks" class="anchor"></a>Alignment &amp; Creating Tracks</h2>
<p>Using a pseudoalignment-based quantification method is nice because it avoids the time-consuming headache of alignment and track generation, saving a lot of time and storage space.</p>
<blockquote>
<p>STAR requires a lot of memory (&gt;32 GB), so running locally is really not recommended. Utilize a computing cluster/cloud.</p>
</blockquote>
<p>If you’re <em>really</em> set on this, something like the following shows how to do so (for single-end reads). Paired-end is similar, you just need to tweak things to provide the second reads file to <code>--readFilesIn</code>. In this case, I use <a href="https://www.gencodegenes.org/human/release_19.html">GENCODE annotations</a>, which provide necessary information for handling gapped-reads spanning splice-junctions (less important here, but critical if attempting de novo transcript discovery).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># bash-cluster</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co"># Create index.</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="ex">STAR</span> --runThreadN 8 --runMode genomeGenerate --genomeDir ./STAR_Index \</a>
<a class="sourceLine" id="cb10-5" title="5">--genomeFastaFiles ./Homo_sapiens.GRCh37.75.dna.primary_assembly.fa \</a>
<a class="sourceLine" id="cb10-6" title="6">--sjdbGTFfile ./gencode.v19.annotation.gtf</a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co"># Align gzipped FASTQs.</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="kw"><a href="https://rdrr.io/r/base/Control.html">for</a></span> <span class="ex">f</span> in *.gz<span class="kw">;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="ex">STAR</span> --runThreadN 8 --runMode alignReads --outFilterMultimapNmax 20 \</a>
<a class="sourceLine" id="cb10-11" title="11">  --alignSJoverhangMin 8 --alignSJDBoverhangMin 1 --alignIntronMin 20 \</a>
<a class="sourceLine" id="cb10-12" title="12">  --alignIntronMax 1000000 --outFilterMismatchNmax 999 \</a>
<a class="sourceLine" id="cb10-13" title="13">  --readFilesCommand gunzip -c --genomeDir ./STAR_Index \</a>
<a class="sourceLine" id="cb10-14" title="14">  --outSAMtype BAM SortedByCoordinate --readFilesIn <span class="st">"</span><span class="va">$f</span><span class="st">"</span> \</a>
<a class="sourceLine" id="cb10-15" title="15">  --outFileNamePrefix <span class="va">${f%%</span>.RNA*<span class="va">}</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="kw">done</span></a>
<a class="sourceLine" id="cb10-17" title="17"></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co"># Change --effectiveGenomeSize if using hg38 or different organism.</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw"><a href="https://rdrr.io/r/base/Control.html">for</a></span> <span class="ex">f</span> in *.bam<span class="kw">;</span> <span class="kw">do</span> </a>
<a class="sourceLine" id="cb10-20" title="20">    <span class="bu">echo</span> <span class="st">"</span><span class="va">$f</span><span class="st">"</span><span class="kw">;</span> </a>
<a class="sourceLine" id="cb10-21" title="21">    <span class="ex">samtools</span> index <span class="st">"</span><span class="va">$f</span><span class="st">"</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb10-22" title="22">    <span class="ex">bamCoverage</span> --bam <span class="st">"</span><span class="va">$f</span><span class="st">"</span> -o <span class="st">"</span><span class="va">$f</span><span class="st">"</span>.rpkm.bw --binSize 10 \</a>
<a class="sourceLine" id="cb10-23" title="23">    --ignoreForNormalization chrX chrM chrY --normalizeUsing RPKM \</a>
<a class="sourceLine" id="cb10-24" title="24">    -p 8 --effectiveGenomeSize 2864785220<span class="kw">;</span> </a>
<a class="sourceLine" id="cb10-25" title="25"><span class="kw">done</span></a></code></pre></div>
<p>Happy? Now you can view the <code>bigWig</code> files on UCSC by using a <a href="https://genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html">track hub</a> if you have a publicly accessible location to put the files.</p>
</div>
</div>
<div id="session-information" class="section level1">
<h1 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session Information</h1>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</a></code></pre></div>
<pre><code>## R version 3.6.1 (2019-07-05)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 16299)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United States.1252 
## [2] LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] OneLinerOmics_0.0.0.9000 BiocStyle_2.13.2        
## 
## loaded via a namespace (and not attached):
##   [1] reticulate_1.13             R.utils_2.9.0              
##   [3] tidyselect_0.2.5            RSQLite_2.1.2              
##   [5] AnnotationDbi_1.47.1        htmlwidgets_1.5.1          
##   [7] grid_3.6.1                  BiocParallel_1.19.1        
##   [9] Rtsne_0.15                  munsell_0.5.0              
##  [11] preprocessCore_1.47.1       codetools_0.2-16           
##  [13] ica_1.0-2                   future_1.14.0              
##  [15] colorspace_1.4-1            Biobase_2.45.1             
##  [17] knitr_1.25                  rstudioapi_0.10            
##  [19] Seurat_3.1.1                stats4_3.6.1               
##  [21] SingleCellExperiment_1.7.11 ROCR_1.0-7                 
##  [23] gbRd_0.4-11                 listenv_0.7.0              
##  [25] Rdpack_0.11-0               tximport_1.13.16           
##  [27] GenomeInfoDbData_1.2.1      bit64_0.9-7                
##  [29] pheatmap_1.0.12             rprojroot_1.3-2            
##  [31] vctrs_0.2.0                 xfun_0.10                  
##  [33] R6_2.4.0                    GenomeInfoDb_1.21.2        
##  [35] ggbeeswarm_0.6.0            rsvd_1.0.2                 
##  [37] locfit_1.5-9.1              bitops_1.0-6               
##  [39] DelayedArray_0.11.7         assertthat_0.2.1           
##  [41] SDMTools_1.1-221.1          scales_1.0.0               
##  [43] nnet_7.3-12                 beeswarm_0.2.3             
##  [45] gtable_0.3.0                npsurv_0.4-0               
##  [47] affy_1.63.1                 globals_0.12.4             
##  [49] rlang_0.4.0                 zeallot_0.1.0              
##  [51] genefilter_1.67.1           splines_3.6.1              
##  [53] lazyeval_0.2.2              acepack_1.4.1              
##  [55] checkmate_1.9.4             BiocManager_1.30.7         
##  [57] yaml_2.2.0                  reshape2_1.4.3             
##  [59] backports_1.1.5             Hmisc_4.2-0                
##  [61] tools_3.6.1                 bookdown_0.14              
##  [63] ggplot2_3.2.1               affyio_1.55.0              
##  [65] gplots_3.0.1.1              RColorBrewer_1.1-2         
##  [67] BiocGenerics_0.31.6         ggridges_0.5.1             
##  [69] Rcpp_1.0.2                  plyr_1.8.4                 
##  [71] base64enc_0.1-3             zlibbioc_1.31.0            
##  [73] purrr_0.3.2                 RCurl_1.95-4.12            
##  [75] rpart_4.1-15                pbapply_1.4-2              
##  [77] viridis_0.5.1               cowplot_1.0.0              
##  [79] S4Vectors_0.23.25           zoo_1.8-6                  
##  [81] SummarizedExperiment_1.15.9 ggrepel_0.8.1              
##  [83] cluster_2.1.0               fs_1.3.1                   
##  [85] magrittr_1.5                data.table_1.12.4          
##  [87] lmtest_0.9-37               RANN_2.6.1                 
##  [89] fitdistrplus_1.0-14         matrixStats_0.55.0         
##  [91] lsei_1.2-0                  evaluate_0.14              
##  [93] xtable_1.8-4                XML_3.98-1.20              
##  [95] IRanges_2.19.16             gridExtra_2.3              
##  [97] compiler_3.6.1              scater_1.13.24             
##  [99] tibble_2.1.3                monocle3_0.1.3.0           
## [101] KernSmooth_2.23-15          crayon_1.3.4               
## [103] R.oo_1.22.0                 htmltools_0.4.0            
## [105] Formula_1.2-3               tidyr_1.0.0                
## [107] geneplotter_1.63.0          RcppParallel_4.4.4         
## [109] DBI_1.0.0                   MASS_7.3-51.4              
## [111] Matrix_1.2-17               vsn_3.53.0                 
## [113] R.methodsS3_1.7.1           gdata_2.18.0               
## [115] parallel_3.6.1              metap_1.1                  
## [117] igraph_1.2.4.1              GenomicRanges_1.37.16      
## [119] pkgconfig_2.0.3             pkgdown_1.4.1              
## [121] foreign_0.8-71              plotly_4.9.0               
## [123] annotate_1.63.0             vipor_0.4.5                
## [125] EnhancedVolcano_1.3.5       XVector_0.25.0             
## [127] bibtex_0.4.2                stringr_1.4.0              
## [129] digest_0.6.21               sctransform_0.2.0          
## [131] RcppAnnoy_0.0.13            tsne_0.1-3                 
## [133] rmarkdown_1.16              leiden_0.3.1               
## [135] enrichR_2.1                 htmlTable_1.13.2           
## [137] uwot_0.1.4                  DelayedMatrixStats_1.7.2   
## [139] gtools_3.8.1                rjson_0.2.20               
## [141] lifecycle_0.1.0             EZscRNA_0.1.0.9000         
## [143] nlme_3.1-140                jsonlite_1.6               
## [145] BiocNeighbors_1.3.5         limma_3.41.17              
## [147] desc_1.2.0                  viridisLite_0.3.0          
## [149] pillar_1.4.2                lattice_0.20-38            
## [151] httr_1.4.1                  survival_2.44-1.1          
## [153] glue_1.3.1                  png_0.1-7                  
## [155] bit_1.1-14                  stringi_1.4.3              
## [157] blob_1.2.0                  DESeq2_1.25.13             
## [159] BiocSingular_1.1.7          latticeExtra_0.6-28        
## [161] caTools_1.17.1.2            memoise_1.1.0              
## [163] dplyr_0.8.3                 irlba_2.3.3                
## [165] future.apply_1.3.0          ape_5.3</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#faqssuggested-reading">FAQs/Suggested Reading</a><ul class="nav nav-pills nav-stacked">
<li><a href="#generating-gene-counts">Generating gene counts</a></li>
      <li><a href="#analysis-with-r">Analysis with R</a></li>
      <li><a href="#alignment-creating-tracks">Alignment &amp; Creating Tracks</a></li>
      </ul>
</li>
      <li><a href="#session-information">Session Information</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://j-andrews7.github.io">Jared Andrews</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
